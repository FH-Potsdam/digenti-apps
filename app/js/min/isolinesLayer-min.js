function isolinesLayer(t){function e(t,e){i(t,e)}function i(t,e){var i=t.geometry.coordinates,r=i[1]+","+i[0],a=30,o="http://localhost:61002/api/isoline/"+r+"/"+a,n=function(r){this.isolinesQueried++;var a=r,o={type:"Feature",properties:{"marker-color":"#f00"},geometry:{type:"Point",coordinates:i}},n=turf.buffer(a,2e3,"meters"),l=turf.inside(o,n.features[0]);if(l){a.properties.osm_id=t.properties.osm_id,a.properties.name=t.properties.name,s.isolinesGeoJSON.features.push(a);var c=s.svglayer.select('g[data-id="'+e+'"]').select(".isoline-group-vis"),u=c.append("path").data([a]).attr("class","isoline").attr("data-id",e)}this.isolinesQueried===places_aoi.features.length&&(this.update(500),console.log("FERTIG"))};$.ajax({dataType:"json",url:o,success:n,error:function(t){alert(t)}})}var s=this;this.circleRadius=5,this.isolineColor="#3dc8e7",this.isolineOpacity=.35,this.isolinesQueried=0,this.bcr=[],this.active=!0,this.isolinesGeoJSON={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[]},this.setActive=function(t){null==t?this.active=!this.active:this.active=t,this.svglayer.classed("disabled",!this.active)},this.init=function(t,e){this.svglayer=t.append("g").attr("id","isolines"),this.setActive(!1),this.svglayer.selectAll("circle").data(e.features).enter().append("g").attr("data-id",function(t){return t.properties.osm_id}).attr("class","isoline-group").each(function(t){if(layoutdebug===!0){var e=d3.select(this);e.append("rect").attr("class","layoutdebug")}}).append("g").attr("class","isoline-group-vis").each(function(t){var e=d3.select(this);e.append("circle").attr("class","village").attr("data-id",function(t){return t.properties.osm_id}).each(function(t){i(t,t.properties.osm_id)})})},this.update=function(t){var e=d3.geo.transform({point:projectPoint}),i=d3.geo.path().projection(e);if(isDefined(this.svglayer))if("smallmultiples"===config.view){var r=0,a=0,o=0,n=0;this.svglayer.selectAll(".isoline-group-vis").each(function(t,e){var i=d3.select(this),s=i.node().getBBox().width,r=i.node().getBBox().height;r>n&&(n=r),s>o&&(o=s)});var l=config.layout.heightperelement/n,c=config.layout.widthperelement/o,u=l;u>c&&(u=c),this.svglayer.selectAll(".isoline-group").each(function(e,i){var s=d3.select(this);layoutdebug===!0&&s.selectAll(".layoutdebug").attr("width",config.layout.widthperelement).attr("height",config.layout.heightperelement),s.transition().duration(t).style("opacity",1).attr("transform",function(){var t=config.layout.offsetLeft+r*(config.layout.gapX+config.layout.widthperelement),e=config.layout.offsetTop+a*(config.layout.gapY+config.layout.heightperelement);return r++,r===config.layout.cols&&(r=0),a++,a===config.layout.rows&&(a=0),"translate("+t+","+e+")"})}),this.svglayer.selectAll(".isoline-group-vis").each(function(e,i){var r=d3.select(this);r.transition().duration(t).style("opacity",1).attr("transform",function(){var t=d3.select(this).node().getBBox(),e=-t.x+config.layout.widthperelement/u/2-t.width/2,i=-t.y+config.layout.heightperelement/u/2-t.height/2;return"scale("+u+") translate("+e+","+i+")"}),r.selectAll("circle").transition().delay(t/6).duration(t).attr({r:config.circleRadius/u}).each(function(){s.bcr[d3.select(this).attr("data-id")]=d3.select(this).node().getBoundingClientRect()})}),this.svglayer.selectAll(".isoline").each(function(t,e){var s=d3.select(this);s.attr("d",i)})}else this.svglayer.selectAll(".isoline-group").each(function(e,i){var s=d3.select(this);s.transition().duration(t).style("opacity",1).attr("transform",function(){return""})}),this.svglayer.selectAll(".isoline-group-vis").each(function(e,i){var s=d3.select(this);s.transition().duration(t).attr("transform",function(){return""})}),this.svglayer.selectAll("circle").each(function(){var e=d3.select(this);e.transition().duration(t).attr({r:config.circleRadius}).attr({cx:function(t){return project(t.geometry.coordinates).x},cy:function(t){return project(t.geometry.coordinates).y}})}),this.svglayer.selectAll(".isoline").each(function(t,e){var s=d3.select(this);s.attr("d",i)})}}
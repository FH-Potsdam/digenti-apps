function mapDraw(e){function t(e){"DIGENTI"===e?map.setStyle("mapbox://styles/jorditost/cipseaugm001ycunimvr00zea"):"DIGENTI-Light"===e?map.setStyle("mapbox://styles/jorditost/ciqc61l3p0023dunqn9e5t4zi"):"DIGENTI-Dark"===e?map.setStyle("mapbox://styles/jorditost/cir1xojwe0020chknbi0y2d5t"):"fos-outdoor"===e?map.setStyle("mapbox://styles/jorditost/cip44ooh90013cjnkmwmwd2ft"):map.setStyle("mapbox://styles/mapbox/"+e)}mapboxgl.accessToken="pk.eyJ1Ijoiam9yZGl0b3N0IiwiYSI6ImQtcVkyclEifQ.vwKrOGZoZSj3N-9MB6FF_A",map=new mapboxgl.Map({container:"map",style:"mapbox://styles/jorditost/ciqc61l3p0023dunqn9e5t4zi",zoom:11,center:[-73.02,10.41]}),map.addControl(new mapboxgl.Navigation),map.on("viewreset",update),map.on("moveend",update),map.on("move",update),svg=d3.select(map.getCanvasContainer()).append("svg").attr("class","map-features"),lineFunction=d3.svg.line().x(function(e){return project(e).x}).y(function(e){return project(e).y}).interpolate("linear"),config.layers.gsm.init(svg,e),config.layers.missingInfrastructure.init(svg,e),triggerMapView(),setMode("missinginfrastructure"),update(0);var o=document.getElementById("basemap_select"),a=o.options;o.onchange=function(){var e=a[o.selectedIndex].value;t(e)}}function update(e){isNaN(e)&&(e=0),config.layers.gsm.update(e),config.layers.missingInfrastructure.update(e)}function reorderSmallMultiples(e){config.orderby=e,d3.selectAll(".orderby").classed("active",!1),d3.selectAll("."+config.orderby).classed("active",!0),update(500)}function setMode(e){config.mode=e,console.log("Set Mode: "+config.mode),d3.selectAll(".mode").classed("active",!1),"missinginfrastructure"===config.mode?(d3.selectAll(".mode.missinginfrastructure").classed("active",!0),config.layers.missingInfrastructure.setActive(!0),config.layers.gsm.setActive(!1)):"routesfromvalledupar"===config.mode&&(d3.selectAll(".mode.routesfromvalledupar").classed("active",!0),config.layers.missingInfrastructure.setActive(!1),config.layers.gsm.setActive(!0))}function triggerMapView(){d3.selectAll(".view").classed("active",!1),d3.selectAll(".mapview").classed("active",!0),d3.selectAll("#orderby").classed("disabled",!0),enableMapInteraction(),config.view="",update(500)}function triggerMapDistancesView(){d3.selectAll(".view").classed("active",!1),d3.selectAll(".mapdistancesview").classed("active",!0),d3.selectAll("#orderby").classed("disabled",!0),enableMapInteraction(),config.view="map-distances",update(500)}function triggerSmallMultiplesView(){d3.selectAll(".view").classed("active",!1),d3.selectAll(".smallmultiplesview").classed("active",!0),d3.selectAll("#orderby").classed("disabled",!1),disableMapInteraction(),config.view="smallmultiples",update(500)}function setMapOpacity(e){d3.selectAll(".mapboxgl-canvas").transition().duration(500).style("opacity",e),d3.selectAll(".mapboxgl-control-container").transition().duration(500).style("opacity",e)}function activateButtons(){d3.selectAll(".disabled").attr("disabled",null)}function enableMapInteraction(){map.scrollZoom.enable(),map.dragPan.enable(),d3.select("#map").classed("disabled",!1)}function disableMapInteraction(){map.scrollZoom.disable(),map.dragPan.disable(),d3.select("#map").classed("disabled",!0)}function selectSettlement(e){console.log(e),$("p.objectID").html(e)}function project(e){return map.project(new mapboxgl.LngLat(+e[0],+e[1]))}var platform=new H.service.Platform({app_id:"EOg7UyuSFbPF0IG5ANjz",app_code:"iRnqNl0dyzX_8FOlchD0ZQ"}),router=platform.getRoutingService(),layoutdebug=!1,map,svg,lineFunction,places_aoi,street_points_aoi,routesArray=[],routesJSON={};routesJSON.routes=[];var config={};config.view="",config.mode="",config.orderby="size",config.layout={},config.layout.w=Math.max(document.documentElement.clientWidth,window.innerWidth||0),config.layout.h=Math.max(document.documentElement.clientHeight,window.innerHeight||0),config.layout.rows=7,config.layout.cols=6,config.layout.gap_hor=.8*config.layout.w/(config.layout.cols+1),config.layout.gap_ver=config.layout.h/(config.layout.rows+1),config.layout.offsetLeft=.25*config.layout.w,config.layout.offsetRight=30,config.layout.offsetTop=.1*config.layout.h,config.layout.offsetBottom=30,config.layout.gapX=15,config.layout.gapY=10,config.layers={},$.getScript("js/routesLayer.js",function(e,t,o){config.layers.gsm=new routesLayer,$.getScript("js/missingInfrastructureLayer.js",function(e,t,o){config.layers.missingInfrastructure=new missingInfrastructureLayer,d3.json("../../data/places_aoi.json",function(e,t){places_aoi=t,d3.json("../../data/street_points_aoi.json",function(e,o){street_points_aoi=o,$.get("data/routes_cached.json").done(function(){d3.json("data/routes_cached.json",function(e,o){routesJSON=o;for(var a=0;a<routesJSON.routes.length;a++)routesArray[routesJSON.routes[a].id]=routesJSON.routes[a].route;mapDraw(t)})}).fail(function(){mapDraw(t)})})})})});
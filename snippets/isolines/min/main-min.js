function mapDraw(e){function o(){map.addSource("colombia-fos",{type:"vector",url:"mapbox://jorditost.49a7b9e1"}),map.addLayer({id:"fos3",type:"line",source:"colombia-fos","source-layer":"colombia_fos_h1_m0_5_CLASSIFIED_wgs84",filter:["==","elev",3],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#e6dc51","line-width":2,"line-opacity":.3}}),map.addLayer({id:"fos2",type:"line",source:"colombia-fos","source-layer":"colombia_fos_h1_m0_5_CLASSIFIED_wgs84",filter:["==","elev",2],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#d9943f","line-width":2,"line-opacity":.3}}),map.addLayer({id:"fos1",type:"line",source:"colombia-fos","source-layer":"colombia_fos_h1_m0_5_CLASSIFIED_wgs84",filter:["==","elev",1],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#c74d4d","line-width":2,"line-opacity":.3}})}function t(e,o){var t=e.geometry.coordinates;console.log(e),"isoline"!==currentMode&&"isoline-all"!==currentMode||n(t,o)}function n(e,o){var t=e[1]+","+e[0],n=parseInt($("#range__slider").val()),a="http://localhost:61002/api/isoline/"+t+"/"+n,i=function(t){var n=t;console.log(JSON.stringify(t)),n.properties.objectID=o;var a={type:"Feature",properties:{"marker-color":"#f00"},geometry:{type:"Point",coordinates:e}},i=turf.buffer(n,500,"meters"),r=turf.inside(a,i.features[0]);r&&(map.addSource(o,{type:"geojson",data:n}),map.addLayer({id:"isoline_"+o,type:"fill",source:o,layout:{},paint:{"fill-color":isolineColor,"fill-opacity":isolineOpacity}}))};$.ajax({dataType:"json",url:a,success:i,error:function(e){alert(e)}})}function a(){p.attr({cx:function(e){return i(e.geometry.coordinates).x},cy:function(e){return i(e.geometry.coordinates).y}}),console.log("UPDATE");for(var e=0;e<isolines_collection.length;e++)"undefined"!=typeof isolines_collection[e]&&isolines_collection[e].attr("points",function(e){for(var o=[],t=0;t<e.length;t++)o.push([i(e[t]).x,i(e[t]).y].join(","));return o.join(" ")})}function i(e){return map.project(new mapboxgl.LngLat(+e[0],+e[1]))}mapboxgl.accessToken="pk.eyJ1Ijoiam9yZGl0b3N0IiwiYSI6ImQtcVkyclEifQ.vwKrOGZoZSj3N-9MB6FF_A",map=new mapboxgl.Map({container:"map",style:"mapbox://styles/jorditost/ciqc61l3p0023dunqn9e5t4zi",zoom:11,center:[-73.02,10.41]}),map.addControl(new mapboxgl.Navigation),map.on("load",function(){});var r=map.getCanvasContainer(),s=d3.select(r).append("svg").attr("class","map-morphed"),l=d3.select(r).append("svg").attr("class","map-features");gRoutes=l.append("g").attr("class","routes");var c=s.append("g").attr("class","route-lines");isolinesGroup=l.append("g").attr("class","isolinesGroup");var p=l.append("g").attr("class","villages").selectAll("circle").data(e.features).enter().append("circle").attr({r:5}).attr("class","village").attr("data-id",function(){return generateUniqueID()}).on("click",function(e){d3.select(this).classed("selected",!0);var o=d3.select(this).attr("data-id");t(e,o)});lineFunction=d3.svg.line().x(function(e){return i(e).x}).y(function(e){return i(e).y}).interpolate("linear"),a(),map.on("viewreset",a),map.on("movestart",function(){l.classed("hidden",!0)}),map.on("moveend",function(){a(),l.classed("hidden",!1)})}function getRandomInt(e,o){return Math.floor(Math.random()*(o-e))+e}function generateUniqueID(){return"id"+(new Date).getTime().toString()+Math.random().toString(36).substr(2,16)}function switchLayer(e){"DIGENTI"==e?map.setStyle("mapbox://styles/jorditost/cipseaugm001ycunimvr00zea"):"DIGENTI-Light"==e?map.setStyle("mapbox://styles/jorditost/ciqc61l3p0023dunqn9e5t4zi"):"DIGENTI-Dark"==e?map.setStyle("mapbox://styles/jorditost/cir1xojwe0020chknbi0y2d5t"):"fos-outdoor"==e?map.setStyle("mapbox://styles/jorditost/cip44ooh90013cjnkmwmwd2ft"):map.setStyle("mapbox://styles/mapbox/"+e),map.on("load",function(){drawFOSLines()})}function showValue(){var e=$("#range__slider").val();document.getElementById("range").innerHTML=e+" minutes"}function setMode(e){d3.selectAll("button.mode").classed("active",!1),currentMode=e,d3.select("."+e).classed("active",!0)}function isolineAll(){setMode("isoline-all"),$(".village").each(function(e){$(this).d3Click()})}var concaveman=require("concaveman"),map,currentMode,isoline,isolines_collection=[],isolinesGroup,isolineColor="#3dc8e7";isolineOpacity=.35,d3.json("../../data/places_aoi.json",function(e,o){mapDraw(o)}),Array.prototype.equals&&console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code."),Array.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var o=0,t=this.length;t>o;o++)if(this[o]instanceof Array&&e[o]instanceof Array){if(!this[o].equals(e[o]))return!1}else if(this[o]!=e[o])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1});var basemap_select=document.getElementById("basemap_select"),basemap_select_options=basemap_select.options;basemap_select.onchange=function(){var e=basemap_select_options[basemap_select.selectedIndex].value;switchLayer(e)},showValue(),$.fn.d3Click=function(){this.each(function(e,o){var t=new MouseEvent("click");o.dispatchEvent(t)})};
function mapDraw(e){function t(e){"DIGENTI"===e?map.setStyle("mapbox://styles/jorditost/cipseaugm001ycunimvr00zea"):"DIGENTI-Light"===e?map.setStyle("mapbox://styles/jorditost/ciqc61l3p0023dunqn9e5t4zi"):"DIGENTI-Dark"===e?map.setStyle("mapbox://styles/jorditost/cir1xojwe0020chknbi0y2d5t"):"fos-outdoor"===e?map.setStyle("mapbox://styles/jorditost/cip44ooh90013cjnkmwmwd2ft"):map.setStyle("mapbox://styles/mapbox/"+e)}mapboxgl.accessToken="pk.eyJ1Ijoiam9yZGl0b3N0IiwiYSI6ImQtcVkyclEifQ.vwKrOGZoZSj3N-9MB6FF_A",map=new mapboxgl.Map({container:"map",style:"mapbox://styles/jorditost/ciqc61l3p0023dunqn9e5t4zi",zoom:11,center:[-73.02,10.41]}),map.addControl(new mapboxgl.Navigation),map.on("viewreset",update),map.on("moveend",update),map.on("move",update);var a=d3.select(map.getCanvasContainer()).append("svg").attr("class","map-features");lineFunction=d3.svg.line().x(function(e){return project(e).x}).y(function(e){return project(e).y}).interpolate("linear"),config.layers.gsm.init(a,e),triggerMapView(),update(500);var o=document.getElementById("basemap_select"),n=o.options;o.onchange=function(){var e=n[o.selectedIndex].value;t(e)}}function update(e){config.layers.gsm.update(e)}function triggerMapView(){d3.selectAll(".view").classed("active",!1),d3.selectAll(".mapview").classed("active",!0),d3.selectAll("#orderby").classed("disabled",!0),config.view="",update(500)}function triggerSmallMultiplesView(){d3.selectAll(".view").classed("active",!1),d3.selectAll(".smallmultiplesview").classed("active",!0),d3.selectAll("#orderby").classed("disabled",!1),config.view="smallmultiples",update(500)}function setMapOpacity(e){d3.selectAll(".mapboxgl-canvas").transition().duration(500).style("opacity",e),d3.selectAll(".mapboxgl-control-container").transition().duration(500).style("opacity",e)}function activateButtons(){d3.selectAll(".disabled").attr("disabled",null)}function enableMapInteraction(){map.scrollZoom.enable(),map.dragPan.enable(),d3.select("#map").classed("disabled",!1)}function disableMapInteraction(){map.scrollZoom.disable(),map.dragPan.disable(),d3.select("#map").classed("disabled",!0)}function project(e){return map.project(new mapboxgl.LngLat(+e[0],+e[1]))}var platform=new H.service.Platform({app_id:"EOg7UyuSFbPF0IG5ANjz",app_code:"iRnqNl0dyzX_8FOlchD0ZQ"}),router=platform.getRoutingService(),w=Math.max(document.documentElement.clientWidth,window.innerWidth||0),h=Math.max(document.documentElement.clientHeight,window.innerHeight||0),lineFunction,map,routesArray=[],routesJSON={};routesJSON.routes=[];var config={};config.view="",config.layers={},$.getScript("test.js",function(e,t,a){config.layers.gsm=new routesLayer}),d3.json("../../data/places_aoi.json",function(e,t){$.get("data/routes_cached.json").done(function(){d3.json("data/routes_cached.json",function(e,a){routesJSON=a;for(var o=0;o<routesJSON.routes.length;o++)routesArray[routesJSON.routes[o].id]=routesJSON.routes[o].route;mapDraw(t)})}).fail(function(){mapDraw(t)})});